name: superinbox-channel-bot

services:
  channel-bot:
    build:
      context: ../../channel-bot
      dockerfile: Dockerfile.runtime
    container_name: superinbox-channel-bot
    restart: unless-stopped
    env_file:
      - ./.env.prod
    environment:
      NODE_ENV: production
      PORT: 3002
      DATABASE_PATH: /app/data/channel-bot.db
      CORE_API_URL: ${CORE_API_URL:-https://www.superinbox.top/v1}
      ENABLED_CHANNELS: ${ENABLED_CHANNELS:-telegram,lark}
    volumes:
      - ../../channel-bot/data:/app/data
    healthcheck:
      test:
        [
          "CMD",
          "node",
          "-e",
          "require('http').get('http://localhost:3002/api/health',(r)=>process.exit(r.statusCode===200?0:1)).on('error',()=>process.exit(1))"
        ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 20s
