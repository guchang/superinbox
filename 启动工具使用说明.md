# SuperInbox 启动工具使用说明

## 概述

SuperInbox 项目提供了两个版本的启动工具:

1. **start.sh** - Bash 脚本版本(适用于 macOS/Linux)
2. **start.js** - Node.js 版本(跨平台支持更好)

两个版本功能完全一致,都提供一键启动前后端服务的功能,并包含智能端口冲突检测和处理。

## 功能特性

- ✅ 自动检测端口占用
- ✅ 交互式处理端口冲突
- ✅ 自动安装依赖
- ✅ 后台运行服务
- ✅ 实时日志查看
- ✅ 进程管理(启动/停止/重启/状态查看)

## 端口配置

默认端口配置:
- **后端服务**: 3000 (可通过环境变量 `BACKEND_PORT` 配置)
- **前端服务**: 3001 (可通过环境变量 `FRONTEND_PORT` 配置)

### 自定义端口

```bash
# 使用自定义端口启动
BACKEND_PORT=8080 FRONTEND_PORT=8081 ./start.sh
```

## 使用方法

### Bash 脚本版本 (macOS/Linux)

#### 1. 基本启动

```bash
./start.sh
```

这个命令会:
1. 检查 Node.js 和 npm 是否安装
2. 询问是否需要安装依赖(如果未安装)
3. 检查端口占用情况
4. 启动后端和前端服务
5. 显示服务访问地址
6. 实时显示服务日志

#### 2. 查看服务状态

```bash
./start.sh status
```

输出示例:
```
========== 服务状态 ==========

后端服务: 运行中 (PID: 12345, 端口: 3000)
前端服务: 运行中 (PID: 12346, 端口: 3001)

============================
```

#### 3. 停止服务

```bash
./start.sh stop
```

停止所有正在运行的前后端服务。

#### 4. 重启服务

```bash
./start.sh restart
```

先停止所有服务,然后重新启动。

### Node.js 版本 (跨平台)

#### 1. 基本启动

```bash
node start.js
# 或者
./start.js  # 需要执行权限
```

#### 2. 查看服务状态

```bash
node start.js status
```

#### 3. 停止服务

```bash
node start.js stop
```

#### 4. 重启服务

```bash
node start.js restart
```

**提示**: Node.js 版本在 Windows 系统上也能正常使用。

## 端口冲突处理

当检测到端口被占用时,工具会提供以下选项:

```
发现以下选项:
  1) 停止占用端口 3000 的进程并继续
  2) 跳过后端启动
  3) 退出脚本

请选择操作 [1-3]:
```

### 选项说明

1. **停止占用进程并继续**
   - 自动停止占用端口的进程
   - 继续启动服务
   - 适用于确认可以停止的旧进程

2. **跳过启动**
   - 跳过当前服务的启动
   - 继续启动其他服务
   - 适用于只想启动部分服务的场景

3. **退出脚本**
   - 停止执行并退出
   - 适用于需要手动处理端口冲突的情况

## 日志管理

服务运行时会产生以下日志文件:

- `backend.log` - 后端服务日志
- `frontend.log` - 前端服务日志

### 查看日志

**方式1: 启动时自动显示**
启动脚本后会自动实时显示日志,按 `Ctrl+C` 可停止查看日志(服务继续运行)。

**方式2: 手动查看**
```bash
# 查看后端日志
tail -f backend.log

# 查看前端日志
tail -f frontend.log

# 同时查看两个日志
tail -f backend.log frontend.log
```

## 进程管理

服务启动后会创建以下 PID 文件:

- `.backend.pid` - 后端进程 ID
- `.frontend.pid` - 前端进程 ID

这些文件用于:
- 跟踪服务运行状态
- 停止服务时找到正确的进程
- 防止重复启动

## 故障排除

### 问题1: 端口被占用无法停止

**解决方案:**
```bash
# 查找占用端口的进程
lsof -i :3000

# 手动停止进程
kill -9 <PID>
```

### 问题2: 依赖安装失败

**解决方案:**
```bash
# 单独安装后端依赖
cd backend
npm install

# 单独安装前端依赖
cd web
npm install
```

### 问题3: 服务启动失败

**解决方案:**
1. 查看日志文件了解错误详情
2. 检查 Node.js 版本 (需要 >= 18.0.0)
3. 确认环境变量配置正确
4. 检查数据库是否已初始化

### 问题4: 前端无法连接后端

**解决方案:**
1. 确认后端服务正在运行: `./start.sh status`
2. 检查后端 API 地址配置
3. 查看浏览器控制台和后端日志

## 高级用法

### 仅启动后端

编辑 `start.sh`,注释掉 `start_frontend` 调用。

### 仅启动前端

编辑 `start.sh`,注释掉 `start_backend` 调用。

### 使用不同端口

```bash
# 启动在开发端口
BACKEND_PORT=3000 FRONTEND_PORT=3001 ./start.sh

# 启动在生产端口
BACKEND_PORT=8080 FRONTEND_PORT=8081 ./start.sh
```

### 集成到其他脚本

```bash
#!/bin/bash
# 你的脚本

cd /path/to/SuperInbox
./start.sh

# 其他操作
```

## 系统要求

### Bash 版本
- **操作系统**: macOS, Linux, WSL
- **工具**: lsof (端口检测,通常系统自带)

### Node.js 版本
- **操作系统**: Windows, macOS, Linux
- **Node.js**: >= 18.0.0 (已安装)

**通用要求**:
- **Node.js**: >= 18.0.0
- **npm**: 任意版本

## 注意事项

1. 首次启动前请确保已安装 Node.js
2. 建议定期更新依赖: `npm update`
3. 生产环境请使用 `npm run build` 构建后启动
4. 停止脚本时服务会继续运行,需使用 `./start.sh stop` 停止
5. PID 文件不要手动删除,可能导致进程管理失效

## 开发建议

### 添加新的服务

在 `start.sh` 中添加新的启动函数:

```bash
start_service_name() {
    cd "$SERVICE_DIR"
    # 检查端口
    handle_port_conflict $PORT "服务名"
    # 启动服务
    nohup npm start > "$PROJECT_ROOT/service.log" 2>&1 &
    echo $! > "$SERVICE_PID_FILE"
}
```

### 自定义日志格式

修改日志输出部分,添加时间戳或颜色:

```bash
log_info() {
    echo -e "${BLUE}[$(date '+%Y-%m-%d %H:%M:%S')]${NC} $1"
}
```

## 反馈与贡献

如有问题或建议,请提交 Issue 或 Pull Request。
