# SuperInbox 启动工具 - 创建总结

## 已创建的文件

### 1. 启动脚本

#### [start.sh](./start.sh) - Bash 脚本版本
- **大小**: ~10KB
- **平台**: macOS, Linux, WSL
- **权限**: 可执行 (chmod +x)
- **端口**:
  - 后端: 3000 (可配置)
  - 前端: 3001 (可配置)

**功能特性**:
- ✅ 自动检测端口占用 (使用 lsof)
- ✅ 交互式处理端口冲突 (3个选项)
- ✅ 自动检查 Node.js 和 npm
- ✅ 可选的依赖安装
- ✅ 后台运行服务
- ✅ PID 文件管理 (.backend.pid, .frontend.pid)
- ✅ 日志文件输出 (backend.log, frontend.log)
- ✅ 实时日志查看 (启动后自动 tail -f)
- ✅ 进程管理命令 (status, stop, restart)
- ✅ 彩色输出 (INFO/SUCCESS/WARNING/ERROR)
- ✅ 优雅的 Ctrl+C 处理

#### [start.js](./start.js) - Node.js 版本
- **大小**: ~13KB
- **平台**: Windows, macOS, Linux (跨平台)
- **权限**: 可执行 (chmod +x)
- **特性**: ES Module, 异步处理

**功能特性**:
- ✅ 所有 Bash 版本的功能
- ✅ 更好的跨平台支持 (包括 Windows)
- ✅ Promise-based 异步操作
- ✅ 更清晰的代码结构
- ✅ 内置进程管理

### 2. 文档

#### [README.md](./README.md) - 项目主文档
- 项目简介
- 快速开始指南
- 常用命令
- 文档导航
- 项目结构
- 端口配置说明

#### [QUICKSTART.md](./QUICKSTART.md) - 快速开始指南
- 一键启动命令
- 服务地址
- 常用命令速查
- 端口冲突处理说明
- 故障排除快速参考
- 下一步指引

#### [启动工具使用说明.md](./启动工具使用说明.md) - 完整文档
- 功能特性详解
- 端口配置说明
- 详细使用方法 (Bash 和 Node.js 两个版本)
- 端口冲突处理流程
- 日志管理方法
- 进程管理机制
- 故障排除指南
- 高级用法
- 系统要求
- 注意事项
- 开发建议

## 核心功能实现

### 1. 端口检测
```bash
# 使用 lsof 检测端口占用
lsof -i :<port> -sTCP:LISTEN -t
```

**功能**:
- 检测端口是否被占用
- 获取占用进程的 PID
- 显示进程命令信息

### 2. 端口冲突处理
提供 3 个交互式选项:
1. **停止占用进程** - kill -9 自动停止
2. **跳过启动** - 跳过当前服务
3. **退出脚本** - 手动处理

### 3. 服务启动流程
```
1. 检查 Node.js/npm
   ↓
2. 询问是否安装依赖 (可选)
   ↓
3. 停止已存在的服务
   ↓
4. 检查后端端口 → 处理冲突
   ↓
5. 启动后端 (后台运行)
   ↓
6. 检查前端端口 → 处理冲突
   ↓
7. 启动前端 (后台运行)
   ↓
8. 显示启动结果
   ↓
9. 实时显示日志
```

### 4. 进程管理
**PID 文件**:
- `.backend.pid` - 后端进程 ID
- `.frontend.pid` - 前端进程 ID

**管理命令**:
- `status` - 检查进程是否运行
- `stop` - 停止进程并清理 PID 文件
- `restart` - 停止后重新启动

### 5. 日志管理
**日志文件**:
- `backend.log` - 后端完整日志
- `frontend.log` - 前端完整日志

**查看方式**:
- 启动时自动 tail -f 实时显示
- 手动 tail -f 查看

## 使用示例

### 基本启动
```bash
# Bash 版本
./start.sh

# Node.js 版本
node start.js
```

### 查看状态
```bash
./start.sh status
```

输出:
```
========== 服务状态 ==========

后端服务: 运行中 (PID: 12345, 端口: 3000)
前端服务: 运行中 (PID: 12346, 端口: 3001)

============================
```

### 停止服务
```bash
./start.sh stop
```

### 自定义端口
```bash
BACKEND_PORT=8080 FRONTEND_PORT=8081 ./start.sh
```

## 端口冲突处理示例

当端口 3000 被占用时:
```
[WARNING] 端口 3000 (后端) 已被占用
  进程 PID: 54321
  进程命令: node /path/to/old/backend

发现以下选项:
  1) 停止占用端口 3000 的进程并继续
  2) 跳过后端启动
  3) 退出脚本

请选择操作 [1-3]: 1
[INFO] 正在停止占用端口 3000 的进程 (PID: 54321)...
[SUCCESS] 已停止进程 54321
[INFO] 启动后端服务 (端口: 3000)...
```

## 技术特点

### Bash 版本
- **兼容性**: POSIX-compliant shells
- **依赖**: lsof, Node.js, npm
- **信号处理**: 捕获 INT 信号 (Ctrl+C)
- **进程管理**: nohup + PID 文件

### Node.js 版本
- **模块**: ES Module
- **异步**: Promise-based
- **跨平台**: 支持 Windows/macOS/Linux
- **进程管理**: child_process.spawn

## 安全特性

1. **权限检查**: 自动检查文件和目录权限
2. **进程验证**: 启动后验证进程是否运行
3. **PID 清理**: 停止时自动清理 PID 文件
4. **日志轮转**: 追加模式写入日志
5. **错误处理**: 完善的错误处理和提示

## 扩展性

### 添加新服务
在脚本中复制启动函数并修改:
```bash
start_new_service() {
    cd "$SERVICE_DIR"
    handle_port_conflict $PORT "服务名"
    nohup npm start > "$PROJECT_ROOT/service.log" 2>&1 &
    echo $! > "$SERVICE_PID_FILE"
}
```

### 自定义日志格式
修改日志函数添加时间戳:
```bash
log_info() {
    echo -e "${BLUE}[$(date '+%Y-%m-%d %H:%M:%S')]${NC} $1"
}
```

## 文件清单

| 文件 | 类型 | 大小 | 描述 |
|------|------|------|------|
| [start.sh](./start.sh) | 脚本 | ~10KB | Bash 启动脚本 |
| [start.js](./start.js) | 脚本 | ~13KB | Node.js 启动脚本 |
| [README.md](./README.md) | 文档 | ~1.4KB | 项目主文档 |
| [QUICKSTART.md](./QUICKSTART.md) | 文档 | ~2KB | 快速开始指南 |
| [启动工具使用说明.md](./启动工具使用说明.md) | 文档 | ~5.5KB | 完整使用文档 |

## 总结

SuperInbox 启动工具提供了:
- ✅ 两个版本 (Bash 和 Node.js) 满足不同平台需求
- ✅ 智能端口检测和冲突处理
- ✅ 完善的进程和日志管理
- ✅ 详细的文档和快速上手指南
- ✅ 良好的扩展性和可维护性

**使用建议**:
- macOS/Linux 用户使用 `start.sh`
- Windows 用户使用 `start.js`
- 生产环境建议添加更多错误处理和监控

**下一步**:
1. 运行 `./start.sh` 或 `node start.js` 启动服务
2. 访问 http://localhost:3001 查看前端
3. 查看 [QUICKSTART.md](./QUICKSTART.md) 了解更多命令
