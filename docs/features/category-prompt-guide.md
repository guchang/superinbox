# 分类提示词使用指南（高级设置）

**适用对象：** 管理员、产品配置人员  
**目标：** 让你在不改代码的情况下，快速优化 SuperInbox 的自动分类效果。

---

## 1. 这个功能能做什么

在「分类管理」页面的**高级设置**里，你可以：

- 查看并编辑“当前提示词”
- 用 AI 智能生成提示词（3 种策略）
- 点击“保存并应用”立即生效
- 效果不理想时，恢复到上一版本

> 说明：这里的“提示词”是分类引擎的系统规则，决定 AI 如何判断分类、提取实体、输出 JSON 结构。

---

## 2. 你需要记住的核心机制（最重要）

分类引擎现在是“**模式化骨架 + 动态分类配置**”模式：

- 模式化骨架：根据节省消耗 / 高精准 / 自定义采用不同约束强度
- 动态分类配置：来自你在“分类管理”里维护的分类 key / 名称 / 规则描述 / 示例

这意味着：

1. 你改了分类规则（描述、示例、启用状态）
2. 不需要改后端代码
3. 新规则会在后续自动分类中生效

---

## 3. 三种“智能生成”模式怎么选

### 3.1 节省消耗

适合：日常快速迭代、对成本敏感场景。  
特点：提示词更精简，token 更省。

### 3.2 高精准

适合：对分类准确率和一致性要求高的场景。  
特点：规则完整、边界清晰、输出稳定。  
补充需求定位：仅用于**补充分类规则**，不会突破安全、输出约束和分类 key 限制。

### 3.3 自定义

适合：你有明确业务偏好，需要定制判断逻辑。  
特点：只保留三层硬性护栏（安全 / 输出约束 / 分类 key 限制），其余按你的需求生成。  
你可以在需求里指定：目标语言（如法语）、分类优先级顺序、额外判断维度等。

### 3.4 语言规则

- 节省消耗、高精准：默认按当前页面语言生成
- 自定义：若你在需求里指定目标语言，优先按你的指定；未指定则按页面语言

---

## 4. 推荐使用流程

1. 在分类管理里先维护好分类（名称、规则描述、示例）
2. 打开高级设置，点“智能生成”选择模式
3. 预览生成结果后，点“保存并应用”
4. 用真实样本测试分类效果
5. 若效果退步，点“恢复到上一版本”（有二次确认）

---

## 5. 占位符说明（不要随意删除）

在生成模板中（尤其是高精准与自定义），可能会看到如下占位符：

- `{{NOW_ISO}}`：当前时间（ISO）
- `{{TIMEZONE}}`：用户时区
- `{{CONTENT_TYPE}}`：内容类型
- `{{CONTENT}}`：待分析正文
- `{{ACTIVE_CATEGORY_KEYS_JSON}}`：当前启用分类 key 列表
- `{{CATEGORY_RULES_JSON}}`：当前分类规则配置
- `{{FALLBACK_CATEGORY_KEY}}`：兜底分类（通常为 unknown）

这些占位符会在运行时自动替换为真实值。  
如果你删除它们，可能导致规则与分类配置脱节。

---

## 6. 示例：为什么“改分类规则”会立即影响结果

假设你把 `schedule` 的描述从：

- “包含时间节点的安排或会议”

改成：

- “含明确日期、相对日期（明天/下周二）或时间段的安排，优先归类为 schedule”

并新增示例：

- “下周二下午和供应商开会”
- “明天 10 点提交审稿意见”

之后，类似文本被识别为 `schedule` 的概率会提升，因为运行时注入了最新分类规则。

---

## 7. 常见问题（FAQ）

### Q1：为什么还会出现 unknown？
A：`unknown` 是系统兜底分类。只有当内容确实无法匹配其他分类时才应使用。若出现过多，请补充对应分类的描述和示例。

### Q2：我点了“保存并应用”，为什么感觉没变化？
A：先确认三点：
- 测试样本是否覆盖了你调整的规则
- 分类是否处于启用状态
- 提示词是否误删了关键约束或占位符

### Q3：自定义模式里，我能让它输出法语或增加新维度吗？
A：可以。只要不违反安全、输出格式和分类 key 限制，自定义模式会优先满足你的需求。你可以要求法语输出、指定分类优先级，或新增判断维度。

### Q4：恢复到上一版本会发生什么？
A：当前提示词会被上一版本替换，并立即成为生效版本；当前未保存编辑会丢失。

---

## 8. 最佳实践

- 每次只改一类规则，便于观察效果变化
- 分类描述尽量“可判定”，避免过于抽象
- 示例尽量覆盖边界情况（容易误判的句子）
- 大改前先复制一份提示词备份
- 出现误判时先补规则和示例，再考虑重写整段提示词

---

## 9. 结论

你可以把“分类管理 + 高级提示词”理解为一套可配置的分类引擎：

- 分类管理提供业务知识（规则与示例）
- 提示词提供推理框架（怎么判断、怎么输出）
- 两者结合后，就能在不改代码的前提下持续优化分类质量
